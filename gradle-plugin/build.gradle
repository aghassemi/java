apply plugin: 'groovy'
apply plugin: 'maven-publish'

dependencies {
    compile gradleApi()
    compile localGroovy()
}

task buildVdl(type: Exec) {
    description 'Build the VDL tool'
    commandLine 'v23', 'go', 'build', '-o', 'build/vdltool/vdl', 'v.io/x/ref/cmd/vdl'
}

sourceSets {
    main {
        resources {
	    srcDir 'build/vdltool'
	}
    }
}

tasks.'processResources'.dependsOn(buildVdl)

publishing {
    publications {
        mavenJava(MavenPublication) {
            groupId 'io.v'
            artifactId 'gradle-plugin'
            version '0.1-SNAPSHOT'

            from components.java
        }
    }
    repositories {
        maven {
            credentials {
                username 'admin'
                password 'admin123'
            }
            url 'http://jring.mtv:8081/nexus/content/repositories/test_repo'
        }
    }
}
